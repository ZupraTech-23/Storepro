<% layout('/layouts/boilerplate') -%>
<link rel="stylesheet" href="/style/dashboard.css">

<div class="dashboard">

  <div class="header">
    <h1>Dashboard</h1>
    <p>Quick business overview</p>
  </div>

  <!-- KPI CARDS -->
  <div class="kpi-grid">

    <div class="kpi-card blue">
      <span>Monthly Revenue</span>
      <h2>₹ <%= Number(monthlyRevenue).toLocaleString() %></h2>
    </div>

    <div class="kpi-card green">
      <span>Today Sales</span>
      <h2>₹ <%= Number(todaySales).toLocaleString() %></h2>
    </div>

    <div class="kpi-card cyan">
      <span>Today Collection</span>
      <h2>₹ <%= Number(todayCollection).toLocaleString() %></h2>
    </div>

    <div class="kpi-card red">
      <span>Total Receivable</span>
      <h2>₹ <%= Number(totalReceivable).toLocaleString() %></h2>
    </div>

    <div class="kpi-card orange">
      <span>Inventory Worth</span>
      <h2>₹ <%= Number(inventoryValue).toLocaleString() %></h2>
    </div>

  </div>

  <!-- GRID -->
  <div class="grid">

    <!-- LEFT -->
    <div>

      <div class="box">
        <h3>Recent Bills</h3>
        <% recentBills.forEach(b => { %>
          <div class="row" onclick="window.location='/bills/<%= b.id %>'">
            <span><%= b.invoice_no %> – <%= b.customer_name %></span>
            <strong>₹ <%= Number(b.grand_total).toLocaleString() %></strong>
          </div>
        <% }) %>
      </div>

      <div class="box">
        <h3>Low Stock Alerts</h3>
        <% if(lowStock.length === 0){ %>
          <p>All stock levels healthy ✅</p>
        <% } %>
        <% lowStock.forEach(i => { %>
          <div class="row warning">
            <span><%= i.name %></span>
            <strong><%= i.stock %> left</strong>
          </div>
        <% }) %>
      </div>

    </div>

    <!-- RIGHT -->
    <div>

      <div class="box">
        <h3>Top Debtors</h3>
        <% topDebtors.forEach(c => { %>
          <div class="row danger">
            <span><%= c.name %></span>
            <strong>₹ <%= Number(c.balance).toLocaleString() %></strong>
          </div>
        <% }) %>
      </div>

    </div>

  </div>

</div>
